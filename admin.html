<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Panel Admin â€“ Votos</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
    background: #f0f0f0;
  }
  h2 { text-align: center; }

  table {
    width: 100%;
    margin-top: 20px;
    border-collapse: collapse;
    background: white;
    border-radius: 8px;
    overflow: hidden;
  }
  th, td {
    padding: 12px;
    border-bottom: 1px solid #ccc;
    text-align: left;
  }
  th {
    background: #0066ff;
    color: white;
  }
</style>
</head>

<body>

<h2>ðŸ“Š Panel de AdministraciÃ³n â€“ Votos Totales</h2>
<p>ActualizaciÃ³n en tiempo real</p>

<table>
  <thead>
    <tr>
      <th>PaÃ­s</th>
      <th>Votos</th>
    </tr>
  </thead>
  <tbody id="voteTable"></tbody>
</table>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-firestore-compat.js"></script>

<script>
// MISMA CONFIG QUE TU INDEX
const firebaseConfig = {
  apiKey: "AIzaSyD4C01qsLQDrm3V8XwYaKXxetxyDZ_uB-w",
  authDomain: "votaciones-cima-culturalweek25.firebaseapp.com",
  projectId: "votaciones-cima-culturalweek25",
  storageBucket: "votaciones-cima-culturalweek25.firebasestorage.app",
  messagingSenderId: "536213861405",
  appId: "1:536213861405:web:b3ba1e1206a43e4025c2f4",
  measurementId: "G-FWMW116PGV"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const tbody = document.getElementById("voteTable");

// Lista de paÃ­ses (debe ser igual que la del index)
const paises = [
  "Egipto",
  "Italia",
  "Brazil",
  "Argentina",
  "Reino Unido",
  "EspaÃ±a",
  "JapÃ³n"
];

// Escuchar votos en tiempo real
db.collection("votes").orderBy("ts", "asc")
.onSnapshot(snapshot => {
  let conteo = {};

  // Inicializar en 0
  paises.forEach(p => conteo[p] = 0);

  snapshot.forEach(doc => {
    let v = doc.data();
    if (conteo[v.choice1] !== undefined) conteo[v.choice1]++;
    if (conteo[v.choice2] !== undefined) conteo[v.choice2]++;
  });

  // Render tabla
  tbody.innerHTML = "";
  paises.forEach(p => {
    tbody.innerHTML += `
      <tr>
        <td>${p}</td>
        <td><b>${conteo[p]}</b></td>
      </tr>
    `;
  });
});
</script>

</body>
</html>
